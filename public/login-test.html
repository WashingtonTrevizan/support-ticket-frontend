<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Test</title>
</head>
<body>
    <h1>Login Test</h1>
    <button onclick="doLogin()">Login com credenciais</button>
    <button onclick="checkDashboard()">Verificar Dashboard</button>
    <pre id="result"></pre>

    <script>
        const API_URL = 'http://localhost:3001';
        
        async function doLogin() {
            const result = document.getElementById('result');
            result.textContent = 'Fazendo login...';
            
            try {
                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: 'ju.trevizan@hotmail.com',
                        password: '12345678'
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    // Salvar no localStorage
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('role', data.user.role);
                    localStorage.setItem('isAuthenticated', 'true');
                    
                    result.textContent = `‚úÖ Login realizado com sucesso!\nUsu√°rio: ${data.user.name}\nRole: ${data.user.role}\nToken salvo no localStorage.`;
                    
                    // Redirecionar para dashboard ap√≥s 2 segundos
                    setTimeout(() => {
                        window.location.href = '/dashboard';
                    }, 2000);
                    
                } else {
                    const errorText = await response.text();
                    result.textContent = `‚ùå Erro no login: ${response.status}\n${errorText}`;
                }
                
            } catch (error) {
                result.textContent = `üí• Erro: ${error.message}`;
            }
        }
        
        async function checkDashboard() {
            const result = document.getElementById('result');
            const token = localStorage.getItem('token');
            
            if (!token) {
                result.textContent = '‚ùå Nenhum token encontrado. Fa√ßa login primeiro.';
                return;
            }
            
            result.textContent = `‚úÖ Token encontrado: ${token.substring(0, 50)}...\nRedirecionando para dashboard...`;
            
            setTimeout(() => {
                window.location.href = '/dashboard';
            }, 1000);
        }
        
        // Verificar se j√° est√° logado
        window.onload = () => {
            const token = localStorage.getItem('token');
            const result = document.getElementById('result');
            
            if (token) {
                result.textContent = `‚ÑπÔ∏è J√° existe um token salvo.\nClique em "Verificar Dashboard" para ir ao dashboard.`;
            } else {
                result.textContent = '‚ÑπÔ∏è Nenhum token encontrado. Clique em "Login com credenciais" para fazer login.';
            }
        };
    </script>
</body>
</html>
